#
# This file describes the common rules for the stages
#
---
.only-master:
  interruptible: true
  variables:
    BRANCH: master
  except:
    - schedules
  only:
    - master@solverstack/pastix
    - master@pastix/pastix

.only-master-mr:
  interruptible: true
  variables:
    BRANCH: branch
  except:
    - schedules
  only:
    - merge_requests
    - master@pastix/pastix
    - master@solverstack/pastix

.test_script_linux:
  stage: test
  tags: ["large", "docker"]
  extends: .only-master-mr
  script:
    - bash .gitlab/test.sh | tee ${LOGNAME}.log
  artifacts:
    name: "$CI_JOB_NAME-$CI_COMMIT_REF_SLUG"
    expire_in: 180 minutes
    paths:
      - ${LOGNAME}.log
      - ${LOGNAME}-junit.xml
      - ${LOGNAME}.lcov
    reports:
      junit: ${LOGNAME}-junit.xml
